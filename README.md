# openshift 4.9 Cluster Installation

## OCP4.9 Cluster Requirements
Below are virtual machines running on RHEL/Centos host with Qemu Virtualization Engine
  - Three Control Plane Machines
  - Three Master Node
  - One Machine for Services ( DNS - DHCP - HAProxy and Webserver) 
  - One Machine for storage ( NFS Server)

## Preparing the OCP-Services Machine : This Machine in installed with Centos 8
  - We Have to install the below services
    - DNS Server bind
    - DHCP Server dhcp
    - HAProxy Server haproxy
    - Apache Server httpd

#### 1) DNS Server Installation : IP 172.16.255.230
Install dns service
  ``` 
  yum -y install bind bind-utils
  cp named.conf /etc/named.conf
  cp named.conf.local /etc/named/
  mkdir /etc/named/zones
  cp db* /etc/named/zones
  ```

start & enable dns service
```
systemctl enable named
systemctl start named
systemctl status named
```
configure firewall ports for dns
```
firewall-cmd --permanent --add-port=53/udp
firewall-cmd --reload
```
Configure the IP to have DNS as same IP : 172.16.255.230
```
systemctl restart NetworkManager
cat /etc/resolve.conf
  Generated by NetworkManager
  nameserver 172.16.255.230
```

#### 2) DHCP Server : Please update the dhcpd.conf with the MAC Address of all your virtual machines 
```
yum -y install dhcp
cp dhcpd.conf /etc/dhcp/dhcpd.conf
systemctl enable dhcpd.service
systemctl start dhcpd.service
systemctl status dhcpd.service

firewall-cmd --permanent --add-service=dhcp
firewall-cmd --reload
```
#### 3) Install HAProxy Loadbalancer for the HTTP,HTTPS and API Traffic 
```
yum install haproxy
cp haproxy.cfg /etc/haproxy/haproxy.cfg

setsebool -P haproxy_connect_any 1
systemctl enable haproxy
systemctl start haproxy
systemctl status haproxy

#### add openshift firewall ports
firewall-cmd --permanent --add-port=6443/tcp
firewall-cmd --permanent --add-port=22623/tcp
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
systemctl restart haproxy
systemctl status haproxy
```
#### 4) Apacher web server 
```
yum install –y httpd
sed -i 's/Listen 80/Listen 8080/' /etc/httpd/conf/httpd.conf
mkdir /var/www/html/ocp
setsebool -P httpd_read_user_content 1
systemctl enable httpd
systemctl start httpd
firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd –reload
curl localhost:8080
```
